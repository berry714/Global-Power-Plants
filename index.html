<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Power Plants Map</title>
    <link href="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v3.2.0/mapbox-gl.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            height: 100%;
        }
        #map {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
            height: 100vh;
        }
        #sidebar {
            position: fixed;
            width: 30%;
            max-width: 400px;
            height: 100%;
            top: 0;
            left: -400px;
            overflow-y: auto;
            background: #f9f9f9;
            z-index: 4;
            transition: left 0.5s;
            padding: 20px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        #sidebar.visible {
            left: 0;
        }
        #sidebar a {
            color: #007bff;
            text-decoration: none;
        }
        #sidebar a:hover {
            text-decoration: underline;
        }
        #fuel-type-filter {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 5;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        #slider-container {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            z-index: 3;
        }
        #legend {
            position: absolute;
            bottom: 50px;
            right: 50px;
            background: white;
            padding: 10px;
            border-radius: 5px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
            z-index: 3;
        }
        #legend h4 {
            margin: 0 0 10px 0;
            font-size: 16px;
            font-weight: bold;
            color: #333;
        }
        #legend div {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        #legend span {
            width: 24px;
            height: 12px;
            display: inline-block;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div id="sidebar">
        <button onclick="toggleSidebar()" style="margin:10px;">Close</button>
        <!-- Information about the power plant will be displayed here -->
    </div>
    <div id="fuel-type-filter">
        <select id="fuel-type-selector">
            <option value="all">All Fuel Types</option>
            <option value="Biomass">Biomass</option>
            <option value="Coal">Coal</option>
            <option value="Gas">Gas</option>
            <option value="Oil">Oil</option>
            <option value="Hydro">Hydro</option>
            <option value="Solar">Solar</option>
            <option value="Other">Other</option>
        </select>
    </div>

    <div id="map"></div>
    
    <div id="slider-container">
        <input type="range" id="capacity-slider" min="0" max="10000" step="10" value="0">
        <p>Minimum Capacity: <span id="capacity-value">0</span> MW</p>
    </div>  
    <div id="legend" style="position: absolute; bottom: 50px; right: 50px; background: white; padding: 10px; border-radius: 5px; z-index: 3;">
        <h4>Primary Fuel Type</h4>
        <div><span style="background-color: #800080; width: 24px; height: 12px; display: inline-block;"></span> Biomass</div>
        <div><span style="background-color: #000000 ; width: 24px; height: 12px; display: inline-block;"></span> Coal</div>
        <div><span style="background-color: #2ca02c; width: 24px; height: 12px; display: inline-block;"></span> Gas</div>
        <div><span style="background-color: #8B4513; width: 24px; height: 12px; display: inline-block;"></span> Oil</div>
        <div><span style="background-color: #1f77b4; width: 24px; height: 12px; display: inline-block;"></span> Hydro</div>
        <div><span style="background-color: #ff7f0e; width: 24px; height: 12px; display: inline-block;"></span> Solar</div>
        <div><span style="background-color: #d62728; width: 24px; height: 12px; display: inline-block;"></span> Other</div>
        
        
        <!-- Add more entries as necessary -->
    </div> 
    <script>
        mapboxgl.accessToken = 'pk.eyJ1Ijoiam9uYXRoYW53ZXN0YmVycnkiLCJhIjoiY2x0OWR4Z3k4MGg2dTJpcDlwc2o0ZXFvayJ9.Muok1VdFLcaVekq6lWlzrA';
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v11',
            center: [0, 0],
            zoom: 1
        });
        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('visible');
            // Resize the map to adjust to the sidebar's new state.
            map.resize();
        }
        map.on('load', function() {
            map.addSource('powerPlants', {
                type: 'geojson',
                data: 'modified_power_plant_data.geojson'
            });
            map.addLayer({
                id: 'plant-points',
                type: 'circle',
                source: 'powerPlants',
                paint: {
                    'circle-radius': 4,
                    'circle-color': [
                        'match',
                        ['get', 'primary_fuel'],
                        'Hydro', '#1f77b4',
                        'Solar', '#ff7f0e',
                        'Gas', '#2ca02c',
                        'Oil', '#8B4513',
                        'Biomass', '#800080',
                        'Other', '#d62728',
                        'Coal', '#000000',
                        /* default */ '#7f7f7f'
                    ],
                }
            });
        });

        map.on('mouseenter', 'plant-points', function() {
            map.getCanvas().style.cursor = 'pointer';
        });
        map.on('mouseleave', 'plant-points', function() {
            map.getCanvas().style.cursor = '';
        });
        map.on('click', 'plant-points', function(e) {
            var feature = e.features[0];
            var properties = feature.properties;
            
            var generationDataContent = '';
            var estimatedGenerationDataContent = '';

            // Check for generation data
            if (properties.generation_gwh_2014 ||
                properties.generation_gwh_2015 ||
                properties.generation_gwh_2016 ||
                properties.generation_gwh_2017 ||
                properties.generation_gwh_2018 ||
                properties.generation_gwh_2019) {
                
                generationDataContent = `
                    <h2>Generation Data:</h2>
                    ${properties.generation_gwh_2014 ? `<p><strong>2014:</strong> ${properties.generation_gwh_2014}</p>` : ''}
                    ${properties.generation_gwh_2015 ? `<p><strong>2015:</strong> ${properties.generation_gwh_2015}</p>` : ''}
                    ${properties.generation_gwh_2016 ? `<p><strong>2016:</strong> ${properties.generation_gwh_2016}</p>` : ''}
                    ${properties.generation_gwh_2017 ? `<p><strong>2017:</strong> ${properties.generation_gwh_2017}</p>` : ''}
                    ${properties.generation_gwh_2018 ? `<p><strong>2018:</strong> ${properties.generation_gwh_2018}</p>` : ''}
                    ${properties.generation_gwh_2019 ? `<p><strong>2019:</strong> ${properties.generation_gwh_2019}</p>` : ''}
                `;
            }

            // Check for estimated generation data
            if (properties.estimated_generation_gwh_2013 ||
                properties.estimated_generation_gwh_2014 ||
                properties.estimated_generation_gwh_2015 ||
                properties.estimated_generation_gwh_2016 ||
                properties.estimated_generation_gwh_2017) {
                
                estimatedGenerationDataContent = `
                    <h2>Estimated Generation Data:</h2>
                    ${properties.estimated_generation_gwh_2013 ? `<p><strong>2013:</strong> ${properties.estimated_generation_gwh_2013}</p>` : ''}
                    ${properties.estimated_generation_gwh_2014 ? `<p><strong>2014:</strong> ${properties.estimated_generation_gwh_2014} (${properties.estimated_generation_note_2014})</p>` : ''}
                    ${properties.estimated_generation_gwh_2015 ? `<p><strong>2015:</strong> ${properties.estimated_generation_gwh_2015} (${properties.estimated_generation_note_2015})</p>` : ''}
                    ${properties.estimated_generation_gwh_2016 ? `<p><strong>2016:</strong> ${properties.estimated_generation_gwh_2016} (${properties.estimated_generation_note_2016})</p>` : ''}
                    ${properties.estimated_generation_gwh_2017 ? `<p><strong>2017:</strong> ${properties.estimated_generation_gwh_2017} (${properties.estimated_generation_note_2017})</p>` : ''}
                `;
            }

            var sidebarContent = `
                <h1>${properties.name}</h1>
                <p><strong>Country:</strong> ${properties.country_long} (${properties.country})</p>
                <p><strong>Capacity (MW):</strong> ${properties.capacity_mw}</p>
                <p><strong>Primary Fuel:</strong> ${properties.primary_fuel}</p>
                ${properties.other_fuel1 ? `<p><strong>Secondary Fuel:</strong> ${properties.other_fuel1}</p>` : ''}
                ${properties.other_fuel2 ? `<p><strong>Tertiary Fuel:</strong> ${properties.other_fuel2}</p>` : ''}
                ${properties.other_fuel3 ? `<p><strong>Other Fuel:</strong> ${properties.other_fuel3}</p>` : ''}
                <p><strong>Source:</strong> ${properties.source}</p>
                ${properties.commissioning_year ? `<p><strong>Commissioning Year:</strong> ${parseInt(properties.commissioning_year)}</p>` : ''}
                ${generationDataContent}
                ${estimatedGenerationDataContent}
                ${properties.url ? `<p><a href="${properties.url}" target="_blank">More Details</a></p>` : ''}
            `;

            document.getElementById('sidebar').innerHTML = sidebarContent;
            document.getElementById('sidebar').classList.add('visible');
            map.resize(); // Ensure the map layout adjusts with the sidebar visible
        });

        // Close the sidebar when clicking anywhere on the map outside of points
        map.on('click', function(e) {
            if (!map.queryRenderedFeatures(e.point, { layers: ['plant-points'] }).length) {
                document.getElementById('sidebar').classList.remove('visible');
                map.resize(); // Adjust the map size back after the sidebar is hidden
            }
        });
        document.getElementById('fuel-type-selector').addEventListener('change', function() {
            var selectedFuel = this.value;

            if (selectedFuel === 'all') {
                map.setFilter('plant-points', null); // Show all features
            } else {
                map.setFilter('plant-points', ['any',
                    ['==', ['get', 'primary_fuel'], selectedFuel],
                    ['==', ['get', 'other_fuel1'], selectedFuel],
                    ['==', ['get', 'other_fuel2'], selectedFuel],
                    ['==', ['get', 'other_fuel3'], selectedFuel]
                ]);
            }
        });
        document.getElementById('capacity-slider').addEventListener('input', function(e) {
            const capacityValue = parseFloat(e.target.value);
            document.getElementById('capacity-value').textContent = capacityValue;
            map.setFilter('plant-points', ['>=', ['get', 'capacity_mw'], capacityValue]);
        });
    </script>
</body>
</html>
